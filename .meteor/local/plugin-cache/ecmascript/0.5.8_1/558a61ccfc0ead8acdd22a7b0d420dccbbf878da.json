{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"meteor/check","imported":["check"],"specifiers":[{"kind":"named","imported":"check","local":"check"}]},{"source":"../api/rooms.js","imported":["Rooms"],"specifiers":[{"kind":"named","imported":"Rooms","local":"Rooms"}]}],"exports":{"exported":["Games"],"specifiers":[{"kind":"local","local":"Games","exported":"Games"}]}}},"options":{"filename":"/imports/api/games.js","filenameRelative":"/imports/api/games.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/api/games.js.map","sourceFileName":"/imports/api/games.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"games"},"ignored":false,"code":"module.export({Games:function(){return Games}});var Meteor;module.import('meteor/meteor',{\"Meteor\":function(v){Meteor=v}});var Mongo;module.import('meteor/mongo',{\"Mongo\":function(v){Mongo=v}});var check;module.import('meteor/check',{\"check\":function(v){check=v}});var Rooms;module.import('../api/rooms.js',{\"Rooms\":function(v){Rooms=v}});\n\n\n\n\nvar Games = new Mongo.Collection('games');\n\n// game config\nacroLettersPool = \"AAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBCCCCCCCCCCCCCCCCCCCCCCCCDDDDDDDDDDDDDDDDDDDDDDDDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEFFFFFFFFFFFFFFFFFFFFFFFFGGGGGGGGGGGGGGGGGGGGGGGGHHHHHHHHHHHHHHHHHHHHHHHHIIIIIIIIIIIIIIIIIIIIIIJJJJJKKKKKKLLLLLLLLLLLLLLLLLLLLLLLLMMMMMMMMMMMMMMMMMMMMMMMMNNNNNNNNNNNNNNNNNNNNNNNNOOOOOOOOOOOOOOOOOOPPPPPPPPPPPPPPPPPPPPPPPPQQQQRRRRRRRRRRRRRRRRRRSSSSSSSSSSSSSSSSSSSSSSSSTTTTTTTTTTTTTTTTTTTTTTTTUUUUUUUVVVVVVVVVVVVWWWWWWWWWWWWXYYYYYYYYYYYYZZZZ\";\n\nacroCategories = [\"General\", \"Sports\", \"Food\", \"Movies\", \"Television\", \"History\", \"Music\", \"Art\", \"Animals\", \"Science\", \"Politics\", \"Fashion\", \"Books\", \"Travel\", \"Celebrities\", \"Romance\", \"Technology\", \"Family\", \"School\", \"Nature\", \"Health\", \"Current Events\", \"Work\", \"Give Some Advice\", \"Definitions\", \"Sayings\", \"Exercise/Fitness\", \"Baby's First Sentence\", \"My Greatest Fear\", \"In the Year 3000\", \"Weird Laws\", \"I Was Late Because...\", \"Odd College Majors\", \"My Biggest Secret\", \"New Ice Cream Flavors\", \"Bad Restaurant Names\", \"I Got Fired Because...\", \"Odd Product Slogans\", \"Bad Habits\", \"Science Fiction\", \"Strange Trends\", \"Embarrassing Moments\", \"CAVEMAN SAY...\", \"Superhero/villain Names\", \"Horror Movie Titles\", \"In a Perfect World...\", \"Short Poetry\", \"New Year's Resolutions\", \"My Dream Last Night\", \"Odd Tombstone Messages\", \"Awful First Dates\", \"Odd Holiday Customs\", \"The Holidays\", \"Short Ghost Stories\", \"... Said No One Ever\", \"Fairy/Folk Tales\"];\n\nroundsToPlay = 8;\nroundTimes = [50, 60, 60, 80, 50, 60, 60, 80];\nroundAcroLength = [3, 4, 5, 6, 3, 4, 5, 6];\n\n////////////\n\nMeteor.methods({\n  'games.init': function () {\n    function gamesInit(roomId) {\n      if (Games.find({ room_id: roomId }).fetch().length === 0) {\n        //always make sure updates only happen once\n        var roundletters;\n        var acroPoolLength = acroLettersPool.length;\n        var catPoolLength = acroCategories.length;\n        var acroPlayArray = [];\n        var acroCatArray = [];\n        for (var i = 0; i < roundsToPlay; i++) {\n          var acroToPlay = \"\";\n          for (var j = 0; j < roundAcroLength[i]; j++) {\n            acroToPlay = acroToPlay + acroLettersPool[Math.floor(Math.random() * acroPoolLength)];\n          }\n          acroPlayArray.push(acroToPlay);\n          acroCatArray.push(acroCategories[Math.floor(Math.random() * catPoolLength)]);\n        }\n        Games.insert({\n          room_id: roomId,\n          roundletters: acroPlayArray,\n          roundcategories: acroCatArray,\n          roundtimes: roundTimes\n        });\n        Rooms.update({ room_id: roomId }, {\n          $set: { round: 1, subround: \"Get ready\" }\n        });\n      }\n    }\n\n    return gamesInit;\n  }(),\n  'games.getready': function () {\n    function gamesGetready(roomId) {\n      if (!readyTimer) {\n        // one timer only\n        var readyTimer = Meteor.setTimeout(function () {\n          if (Gameplay.find({ room_id: roomId }).fetch().length === 0) {\n            Meteor.call('games.reset', roomId);\n          } else {\n            Rooms.update({ room_id: roomId }, {\n              $set: { subround: \"Play\" }\n            });\n          }\n        }, 7000);\n        readyTimer = null;\n      }\n    }\n\n    return gamesGetready;\n  }(),\n  'games.play': function () {\n    function gamesPlay(roomId, roundtime) {\n      if (!playTimer) {\n        // one timer only\n        var playTimer = Meteor.setTimeout(function () {\n          if (Gameplay.find({ room_id: roomId }).fetch().length === 0) {\n            Meteor.call('games.reset', roomId);\n          } else {\n            Rooms.update({ room_id: roomId }, {\n              $set: { subround: \"Vote\" }\n            });\n          }\n        }, roundtime * 1000 + 20000);\n        playTimer = null;\n      }\n    }\n\n    return gamesPlay;\n  }(),\n  'games.vote': function () {\n    function gamesVote(roomId) {\n      if (!voteTimer) {\n        // one timer only\n        var voteTimer = Meteor.setTimeout(function () {\n          if (Gameplay.find({ room_id: roomId }).fetch().length === 0) {\n            Meteor.call('games.reset', roomId);\n          } else {\n            Rooms.update({ room_id: roomId }, {\n              $set: { subround: \"Results\" }\n            });\n          }\n        }, 35000);\n        voteTimer = null;\n      }\n    }\n\n    return gamesVote;\n  }(),\n  'games.results': function () {\n    function gamesResults(roomId) {\n      if (!resultsTimer) {\n        // one timer only\n        var currentRound = Rooms.findOne({ room_id: roomId }).round;\n        if (currentRound === roundsToPlay) {\n          var resultsTimer = Meteor.setTimeout(function () {\n            if (Gameplay.find({ room_id: roomId }).fetch().length < 2) {\n              // end game after results if not enough players\n              Meteor.call('games.reset', roomId);\n            } else {\n              Rooms.update({ room_id: roomId }, {\n                $set: { subround: \"Final results\" }\n              });\n            }\n          }, 22000);\n        } else {\n          var resultsTimer = Meteor.setTimeout(function () {\n            if (Gameplay.find({ room_id: roomId }).fetch().length < 2) {\n              // end game after results if not enough players\n              Meteor.call('games.reset', roomId);\n            } else {\n              Rooms.update({ room_id: roomId }, {\n                $set: { round: currentRound + 1,\n                  subround: \"Get ready\" }\n              });\n            }\n          }, 22000);\n        }\n        resultsTimer = null;\n      }\n    }\n\n    return gamesResults;\n  }(),\n  'games.finalresults': function () {\n    function gamesFinalresults(roomId) {\n      if (!finalTimer) {\n        // one timer only\n        var finalTimer = Meteor.setTimeout(function () {\n          if (Gameplay.find({ room_id: roomId }).fetch().length < 2) {\n            // end game after results if not enough players\n            Meteor.call('games.reset', roomId);\n          } else {\n            // set up for new game\n            Games.remove({ room_id: roomId });\n            Meteor.call('games.init', roomId);\n          }\n        }, 25000);\n      }\n      finalTimer = null;\n    }\n\n    return gamesFinalresults;\n  }(),\n  'games.reset': function () {\n    function gamesReset(roomId) {\n      Games.remove({ room_id: roomId });\n      Rooms.update({ room_id: roomId }, {\n        $set: { round: 0,\n          subround: \"Waiting for players\" }\n      });\n    }\n\n    return gamesReset;\n  }()\n});\n\n// Games.find({ room_id: roomId }).remove({});","ast":null,"map":{"version":3,"sources":["/imports/api/games.js"],"names":[],"mappings":"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","file":"/imports/api/games.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { check } from 'meteor/check';\n\nimport { Rooms } from '../api/rooms.js';\nexport const Games = new Mongo.Collection('games');\n\n// game config\nacroLettersPool = \"AAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBCCCCCCCCCCCCCCCCCCCCCCCCDDDDDDDDDDDDDDDDDDDDDDDDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEFFFFFFFFFFFFFFFFFFFFFFFFGGGGGGGGGGGGGGGGGGGGGGGGHHHHHHHHHHHHHHHHHHHHHHHHIIIIIIIIIIIIIIIIIIIIIIJJJJJKKKKKKLLLLLLLLLLLLLLLLLLLLLLLLMMMMMMMMMMMMMMMMMMMMMMMMNNNNNNNNNNNNNNNNNNNNNNNNOOOOOOOOOOOOOOOOOOPPPPPPPPPPPPPPPPPPPPPPPPQQQQRRRRRRRRRRRRRRRRRRSSSSSSSSSSSSSSSSSSSSSSSSTTTTTTTTTTTTTTTTTTTTTTTTUUUUUUUVVVVVVVVVVVVWWWWWWWWWWWWXYYYYYYYYYYYYZZZZ\";\n\nacroCategories = [\"General\", \"Sports\", \"Food\", \"Movies\", \"Television\", \"History\", \"Music\", \"Art\", \"Animals\",\n                  \"Science\", \"Politics\", \"Fashion\", \"Books\", \"Travel\", \"Celebrities\", \"Romance\", \"Technology\",\n                  \"Family\", \"School\", \"Nature\", \"Health\", \"Current Events\", \"Work\", \"Give Some Advice\",\n                  \"Definitions\", \"Sayings\", \"Exercise/Fitness\", \"Baby's First Sentence\", \"My Greatest Fear\",\n                  \"In the Year 3000\", \"Weird Laws\", \"I Was Late Because...\", \"Odd College Majors\",\n                  \"My Biggest Secret\", \"New Ice Cream Flavors\", \"Bad Restaurant Names\",\n                  \"I Got Fired Because...\", \"Odd Product Slogans\", \"Bad Habits\", \"Science Fiction\",\n                  \"Strange Trends\", \"Embarrassing Moments\", \"CAVEMAN SAY...\", \"Superhero/villain Names\",\n                  \"Horror Movie Titles\", \"In a Perfect World...\", \"Short Poetry\", \"New Year's Resolutions\",\n                  \"My Dream Last Night\", \"Odd Tombstone Messages\", \"Awful First Dates\", \"Odd Holiday Customs\",\n                  \"The Holidays\", \"Short Ghost Stories\", \"... Said No One Ever\", \"Fairy/Folk Tales\"]\n\nroundsToPlay = 8;\nroundTimes = [50, 60, 60, 80, 50, 60, 60 ,80]\nroundAcroLength = [3, 4, 5, 6, 3, 4, 5, 6]\n\n////////////\n\nMeteor.methods({\n  'games.init'(roomId) {\n    if (Games.find({ room_id: roomId }).fetch().length === 0) { //always make sure updates only happen once\n      var roundletters;\n      var acroPoolLength = acroLettersPool.length;\n      var catPoolLength = acroCategories.length;\n      var acroPlayArray = [];\n      var acroCatArray = [];\n      for (var i = 0; i < roundsToPlay; i++) {\n        var acroToPlay = \"\";\n        for (var j = 0; j < roundAcroLength[i]; j++) {\n          acroToPlay = acroToPlay + acroLettersPool[Math.floor(Math.random() * acroPoolLength)]\n        }\n        acroPlayArray.push(acroToPlay);\n        acroCatArray.push(acroCategories[Math.floor(Math.random() * catPoolLength)])\n      }\n      Games.insert({\n        room_id: roomId,\n        roundletters: acroPlayArray,\n        roundcategories: acroCatArray,\n        roundtimes: roundTimes\n      });\n      Rooms.update({room_id: roomId}, {\n        $set: { round: 1 , subround: \"Get ready\" },\n      });\n    }\n  },\n\n  'games.getready'(roomId) {\n    if (!readyTimer) { // one timer only\n      var readyTimer = Meteor.setTimeout(function() {\n        if (Gameplay.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Play\" },\n          });\n        }\n      }, 7000);\n      readyTimer = null;\n    }\n  },\n\n  'games.play'(roomId, roundtime) {\n    if (!playTimer) { // one timer only\n      var playTimer = Meteor.setTimeout(function() {\n        if (Gameplay.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Vote\" },\n          });\n        }\n      }, (roundtime * 1000) + 20000);\n      playTimer = null;\n    }\n  },\n\n  'games.vote'(roomId) {\n    if (!voteTimer) { // one timer only\n      var voteTimer = Meteor.setTimeout(function() {\n        if (Gameplay.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Results\" },\n          });\n        }\n      }, 35000);\n      voteTimer = null;\n    }\n  },\n\n  'games.results'(roomId) {\n    if (!resultsTimer) { // one timer only\n      var currentRound = Rooms.findOne({room_id: roomId}).round;\n      if (currentRound === roundsToPlay) {\n        var resultsTimer = Meteor.setTimeout(function() {\n          if (Gameplay.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n            Meteor.call('games.reset', roomId );\n          } else {\n            Rooms.update({room_id: roomId}, {\n              $set: { subround: \"Final results\" },\n            });\n          }\n        }, 22000);\n      } else {\n        var resultsTimer = Meteor.setTimeout(function() {\n          if (Gameplay.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n            Meteor.call('games.reset', roomId );\n          } else {\n            Rooms.update({room_id: roomId}, {\n              $set: { round: currentRound + 1,\n                      subround: \"Get ready\" },\n            });\n          }\n        }, 22000);\n      }\n      resultsTimer = null;\n    }\n  },\n\n  'games.finalresults'(roomId) {\n    if (!finalTimer) { // one timer only\n      var finalTimer = Meteor.setTimeout(function() {\n        if (Gameplay.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n          Meteor.call('games.reset', roomId );\n        } else { // set up for new game\n          Games.remove({ room_id: roomId });\n          Meteor.call('games.init', roomId );\n        }\n      }, 25000);\n    }\n    finalTimer = null;\n  },\n\n  'games.reset'(roomId) {\n    Games.remove({ room_id: roomId });\n    Rooms.update({room_id: roomId}, {\n      $set: { round: 0,\n              subround: \"Waiting for players\" },\n    });\n  }\n\n\n\n\n})\n\n    // Games.find({ room_id: roomId }).remove({});\n"]},"hash":"558a61ccfc0ead8acdd22a7b0d420dccbbf878da"}
