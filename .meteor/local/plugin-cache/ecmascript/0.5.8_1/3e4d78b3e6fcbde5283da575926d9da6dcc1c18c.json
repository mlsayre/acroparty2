{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/mongo","imported":["Mongo"],"specifiers":[{"kind":"named","imported":"Mongo","local":"Mongo"}]},{"source":"meteor/check","imported":["check"],"specifiers":[{"kind":"named","imported":"check","local":"check"}]},{"source":"react-dom","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"ReactDOM"}]},{"source":"../api/rooms.js","imported":["Rooms"],"specifiers":[{"kind":"named","imported":"Rooms","local":"Rooms"}]},{"source":"../api/gamedata.js","imported":["Gamedata"],"specifiers":[{"kind":"named","imported":"Gamedata","local":"Gamedata"}]}],"exports":{"exported":["Games"],"specifiers":[{"kind":"local","local":"Games","exported":"Games"}]}}},"options":{"filename":"/imports/api/games.js","filenameRelative":"/imports/api/games.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/api/games.js.map","sourceFileName":"/imports/api/games.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"games"},"ignored":false,"code":"module.export({Games:function(){return Games}});var Meteor;module.import('meteor/meteor',{\"Meteor\":function(v){Meteor=v}});var Mongo;module.import('meteor/mongo',{\"Mongo\":function(v){Mongo=v}});var check;module.import('meteor/check',{\"check\":function(v){check=v}});var ReactDOM;module.import('react-dom',{\"default\":function(v){ReactDOM=v}});var Rooms;module.import('../api/rooms.js',{\"Rooms\":function(v){Rooms=v}});var Gamedata;module.import('../api/gamedata.js',{\"Gamedata\":function(v){Gamedata=v}});\n\n\n\n\n\n\nvar Games = new Mongo.Collection('games');\n\n// game config\nacroLettersPool = \"AAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBCCCCCCCCCCCCCCCCCCCCCCCCDDDDDDDDDDDDDDDDDDDDDDDDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEFFFFFFFFFFFFFFFFFFFFFFFFGGGGGGGGGGGGGGGGGGGGGGGGHHHHHHHHHHHHHHHHHHHHHHHHIIIIIIIIIIIIIIIIIIIIIIJJJJJKKKKKKLLLLLLLLLLLLLLLLLLLLLLLLMMMMMMMMMMMMMMMMMMMMMMMMNNNNNNNNNNNNNNNNNNNNNNNNOOOOOOOOOOOOOOOOOOPPPPPPPPPPPPPPPPPPPPPPPPQQQQRRRRRRRRRRRRRRRRRRSSSSSSSSSSSSSSSSSSSSSSSSTTTTTTTTTTTTTTTTTTTTTTTTUUUUUUUVVVVVVVVVVVVWWWWWWWWWWWWXYYYYYYYYYYYYZZZZ\";\n\nacroCategories = [\"General\", \"Sports\", \"Food\", \"Movies\", \"Television\", \"History\", \"Music\", \"Art\", \"Animals\", \"Science\", \"Politics\", \"Fashion\", \"Books\", \"Travel\", \"Celebrities\", \"Romance\", \"Technology\", \"Family\", \"School\", \"Nature\", \"Health\", \"Current Events\", \"Work\", \"Give Some Advice\", \"Definitions\", \"Sayings\", \"Exercise/Fitness\", \"Baby's First Sentence\", \"My Greatest Fear\", \"In the Year 3000\", \"Weird Laws\", \"I Was Late Because...\", \"Odd College Majors\", \"My Biggest Secret\", \"New Ice Cream Flavors\", \"Bad Restaurant Names\", \"I Got Fired Because...\", \"Odd Product Slogans\", \"Bad Habits\", \"Science Fiction\", \"Strange Trends\", \"Embarrassing Moments\", \"CAVEMAN SAY...\", \"Superhero/villain Names\", \"Horror Movie Titles\", \"In a Perfect World...\", \"Short Poetry\", \"New Year's Resolutions\", \"My Dream Last Night\", \"Odd Tombstone Messages\", \"Awful First Dates\", \"Odd Holiday Customs\", \"The Holidays\", \"Short Ghost Stories\", \"... Said No One Ever\", \"Fairy/Folk Tales\"];\n\nroundsToPlay = 8;\nroundTimes = [9, 9, 9, 9, 9, 9, 9, 9]; // [50, 60, 60, 80, 50, 60, 60 ,80]\nroundAcroLength = [3, 4, 5, 6, 3, 4, 5, 6];\nreadyTimer = {};\nplayTimer = {};\nvoteTimer = {};\nresultsTimer = {};\nfinalTimer = {};\n\nvar playTimerStatus = \"init\";\n\n////////////\n\nMeteor.methods({\n  'games.init': function gamesInit(roomId) {\n    if (Games.find({ room_id: roomId }).fetch().length === 0) {\n      //always make sure updates only happen once\n      readyTimer = {};\n      playTimer = {};\n      playStartTimer = {};\n      voteTimer = {};\n      resultsTimer = {};\n      finalTimer = {};\n      var roundletters;\n      var acroPoolLength = acroLettersPool.length;\n      var catPoolLength = acroCategories.length;\n      var acroPlayArray = [];\n      var acroCatArray = [];\n      for (var i = 0; i < roundsToPlay; i++) {\n        var acroToPlay = \"\";\n        for (var j = 0; j < roundAcroLength[i]; j++) {\n          acroToPlay = acroToPlay + acroLettersPool[Math.floor(Math.random() * acroPoolLength)];\n        }\n        acroPlayArray.push(acroToPlay);\n        acroCatArray.push(acroCategories[Math.floor(Math.random() * catPoolLength)]);\n      }\n      Games.insert({\n        room_id: roomId,\n        roundletters: acroPlayArray,\n        roundcategories: acroCatArray,\n        roundtimes: roundTimes\n      });\n      Rooms.update({ room_id: roomId }, {\n        $set: { round: 1, subround: \"Get ready\" }\n      });\n    }\n  },\n  'games.getready': function gamesGetready(roomId) {\n    if (!readyTimer[roomId]) {\n      // one timer only\n      readyTimer[roomId] = Meteor.setTimeout(function () {\n        if (Gamedata.find({ room_id: roomId }).fetch().length === 0) {\n          Meteor.call('games.reset', roomId);\n        } else {\n          Rooms.update({ room_id: roomId }, {\n            $set: { subround: \"Play\" }\n          });\n        }\n        delete readyTimer[roomId];\n      }, 3500);\n    }\n  },\n  'games.play': function gamesPlay(roomId, roundtime) {\n    if (playTimerStatus !== \"Play running\") {\n      // one timer only\n      playTimerStatus = \"Play running\";\n      console.log(\"This should run ONCE\");\n      var numberOfLetters = roundAcroLength[Rooms.findOne({ room_id: roomId }).round - 1];\n      Games.update({ room_id: roomId }, {\n        $set: { turnLetters: true }\n      });\n      playTimer[roomId] = Meteor.setTimeout(function () {\n        if (Gamedata.find({ room_id: roomId }).fetch().length === 0) {\n          Meteor.call('games.reset', roomId);\n        } else {\n          Rooms.update({ room_id: roomId }, {\n            $set: { subround: \"Vote\" }\n          });\n        }\n        playTimerStatus = \"Play complete\";\n      }, roundtime * 1000 + numberOfLetters * 1000 + 5000);\n      Meteor.setTimeout(function () {\n        Games.update({ room_id: roomId }, {\n          $set: { playStartAnswering: true,\n            timerSeconds: roundtime }\n        });\n        timer(roundtime, roomId, \"playtimerstate\");\n      }, numberOfLetters * 1000 + 2000);\n\n      Meteor.setTimeout(function () {\n        Meteor.call('games.letterFlipFlagOff', roomId);\n      }, 2000);\n    }\n  },\n  'games.vote': function gamesVote(roomId) {\n    // Games.update({room_id: roomId}, {\n    //   $set: { playStartAnswering: false }\n    // })\n    if (!voteTimer[roomId]) {\n      // one timer only\n      voteTimer[roomId] = Meteor.setTimeout(function () {\n        if (Gamedata.find({ room_id: roomId }).fetch().length === 0) {\n          Meteor.call('games.reset', roomId);\n        } else {\n          Rooms.update({ room_id: roomId }, {\n            $set: { subround: \"Results\" }\n          });\n        }\n        delete voteTimer[roomId];\n      }, 4000); //35000\n    }\n  },\n  'games.results': function gamesResults(roomId) {\n    if (!resultsTimer[roomId]) {\n      // one timer only\n      var currentRound = Rooms.findOne({ room_id: roomId }).round;\n      if (currentRound === roundsToPlay) {\n        resultsTimer[roomId] = Meteor.setTimeout(function () {\n          if (Gamedata.find({ room_id: roomId }).fetch().length < 2) {\n            // end game after results if not enough players\n            delete resultsTimer[roomId];\n            Meteor.call('games.reset', roomId);\n          } else {\n            Rooms.update({ room_id: roomId }, {\n              $set: { subround: \"Final results\" }\n            });\n          }\n          delete resultsTimer[roomId];\n        }, 22000);\n      } else {\n        resultsTimer[roomId] = Meteor.setTimeout(function () {\n          if (Gamedata.find({ room_id: roomId }).fetch().length < 2) {\n            // end game after results if not enough players\n            delete resultsTimer[roomId];\n            Meteor.call('games.reset', roomId);\n          } else {\n            Rooms.update({ room_id: roomId }, {\n              $set: { round: currentRound + 1,\n                subround: \"Get ready\" }\n            });\n          }\n          delete resultsTimer[roomId];\n        }, 3000); //22000\n      }\n    }\n  },\n  'games.finalresults': function gamesFinalresults(roomId) {\n    if (!finalTimer[roomId]) {\n      // one timer only\n      finalTimer[roomId] = Meteor.setTimeout(function () {\n        if (Gamedata.find({ room_id: roomId }).fetch().length < 2) {\n          // end game after results if not enough players\n          delete finalTimer[roomId];\n          Meteor.call('games.reset', roomId);\n        } else {\n          // set up for new game\n          Games.remove({ room_id: roomId });\n          Meteor.call('games.init', roomId);\n        }\n        delete finalTimer[roomId];\n      }, 25000);\n    }\n    readyTimer = {};\n    playTimer = {};\n    playStartTimer = {};\n    voteTimer = {};\n    resultsTimer = {};\n  },\n  'games.reset': function gamesReset(roomId) {\n    Games.remove({ room_id: roomId });\n    Gamedata.remove({ room_id: roomId });\n    Rooms.update({ room_id: roomId }, {\n      $set: { round: 0,\n        subround: \"Waiting for players\" }\n    });\n    readyTimer = {};\n    playTimer = {};\n    playStartTimer = {};\n    voteTimer = {};\n    resultsTimer = {};\n  },\n  'games.letterFlipFlagOff': function gamesLetterFlipFlagOff(roomId) {\n    Games.update({ room_id: roomId }, {\n      $set: { turnLetters: false }\n    });\n  }\n});\n\nfunction timer(seconds, roomId, statetoactivate) {\n\n  Meteor.setTimeout(function () {\n    var countdownStartTime = new Date();\n    if (statetoactivate === \"playtimerstate\") {\n      Games.update({ room_id: roomId }, {\n        $set: { playStartTime: countdownStartTime,\n          showAnswerForm: true }\n      });\n    } else {\n      Games.update({ room_id: roomId }, {\n        $set: { voteStartTime: countdownStartTime }\n      });\n    }\n    var count = seconds;\n    var counter = Meteor.setInterval(tock, 1000);\n\n    function tock() {\n      count = count - 1;\n      if (count < 0) {\n        Meteor.clearInterval(counter);\n        Games.update({ room_id: roomId }, {\n          $set: { showAnswerForm: false }\n        });\n        return;\n      }\n      Games.update({ room_id: roomId }, {\n        $set: { timerSeconds: count }\n      });\n    }\n  }, 2000);\n}\n\n// Games.find({ room_id: roomId }).remove({});","ast":null,"map":{"version":3,"sources":["/imports/api/games.js"],"names":[],"mappings":"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","file":"/imports/api/games.js.map","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { check } from 'meteor/check';\nimport ReactDOM from 'react-dom';\n\nimport { Rooms } from '../api/rooms.js';\nimport { Gamedata } from '../api/gamedata.js';\nexport const Games = new Mongo.Collection('games');\n\n// game config\nacroLettersPool = \"AAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBCCCCCCCCCCCCCCCCCCCCCCCCDDDDDDDDDDDDDDDDDDDDDDDDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEFFFFFFFFFFFFFFFFFFFFFFFFGGGGGGGGGGGGGGGGGGGGGGGGHHHHHHHHHHHHHHHHHHHHHHHHIIIIIIIIIIIIIIIIIIIIIIJJJJJKKKKKKLLLLLLLLLLLLLLLLLLLLLLLLMMMMMMMMMMMMMMMMMMMMMMMMNNNNNNNNNNNNNNNNNNNNNNNNOOOOOOOOOOOOOOOOOOPPPPPPPPPPPPPPPPPPPPPPPPQQQQRRRRRRRRRRRRRRRRRRSSSSSSSSSSSSSSSSSSSSSSSSTTTTTTTTTTTTTTTTTTTTTTTTUUUUUUUVVVVVVVVVVVVWWWWWWWWWWWWXYYYYYYYYYYYYZZZZ\";\n\nacroCategories = [\"General\", \"Sports\", \"Food\", \"Movies\", \"Television\", \"History\", \"Music\", \"Art\", \"Animals\",\n                  \"Science\", \"Politics\", \"Fashion\", \"Books\", \"Travel\", \"Celebrities\", \"Romance\", \"Technology\",\n                  \"Family\", \"School\", \"Nature\", \"Health\", \"Current Events\", \"Work\", \"Give Some Advice\",\n                  \"Definitions\", \"Sayings\", \"Exercise/Fitness\", \"Baby's First Sentence\", \"My Greatest Fear\",\n                  \"In the Year 3000\", \"Weird Laws\", \"I Was Late Because...\", \"Odd College Majors\",\n                  \"My Biggest Secret\", \"New Ice Cream Flavors\", \"Bad Restaurant Names\",\n                  \"I Got Fired Because...\", \"Odd Product Slogans\", \"Bad Habits\", \"Science Fiction\",\n                  \"Strange Trends\", \"Embarrassing Moments\", \"CAVEMAN SAY...\", \"Superhero/villain Names\",\n                  \"Horror Movie Titles\", \"In a Perfect World...\", \"Short Poetry\", \"New Year's Resolutions\",\n                  \"My Dream Last Night\", \"Odd Tombstone Messages\", \"Awful First Dates\", \"Odd Holiday Customs\",\n                  \"The Holidays\", \"Short Ghost Stories\", \"... Said No One Ever\", \"Fairy/Folk Tales\"]\n\nroundsToPlay = 8;\nroundTimes = [9,9,9,9,9,9,9,9] // [50, 60, 60, 80, 50, 60, 60 ,80]\nroundAcroLength = [3, 4, 5, 6, 3, 4, 5, 6]\nreadyTimer = {}\nplayTimer = {}\nvoteTimer = {}\nresultsTimer = {}\nfinalTimer = {}\n\nvar playTimerStatus = \"init\"\n\n\n////////////\n\nMeteor.methods({\n  'games.init'(roomId) {\n    if (Games.find({ room_id: roomId }).fetch().length === 0) { //always make sure updates only happen once\n      readyTimer = {}\n      playTimer = {}\n      playStartTimer = {}\n      voteTimer = {}\n      resultsTimer = {}\n      finalTimer = {}\n      var roundletters;\n      var acroPoolLength = acroLettersPool.length;\n      var catPoolLength = acroCategories.length;\n      var acroPlayArray = [];\n      var acroCatArray = [];\n      for (var i = 0; i < roundsToPlay; i++) {\n        var acroToPlay = \"\";\n        for (var j = 0; j < roundAcroLength[i]; j++) {\n          acroToPlay = acroToPlay + acroLettersPool[Math.floor(Math.random() * acroPoolLength)]\n        }\n        acroPlayArray.push(acroToPlay);\n        acroCatArray.push(acroCategories[Math.floor(Math.random() * catPoolLength)])\n      }\n      Games.insert({\n        room_id: roomId,\n        roundletters: acroPlayArray,\n        roundcategories: acroCatArray,\n        roundtimes: roundTimes\n      });\n      Rooms.update({room_id: roomId}, {\n        $set: { round: 1 , subround: \"Get ready\" },\n      });\n    }\n  },\n\n  'games.getready'(roomId) {\n    if (!readyTimer[roomId]) { // one timer only\n      readyTimer[roomId] = Meteor.setTimeout(function() {\n        if (Gamedata.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Play\" },\n          });\n        }\n        delete readyTimer[roomId];\n      }, 3500);\n    }\n  },\n\n  'games.play'(roomId, roundtime) {\n    if (playTimerStatus !== \"Play running\") { // one timer only\n      playTimerStatus = \"Play running\"\n      console.log(\"This should run ONCE\")\n      var numberOfLetters = roundAcroLength[Rooms.findOne({room_id: roomId}).round - 1]\n      Games.update({room_id: roomId}, {\n        $set: { turnLetters: true }\n      })\n      playTimer[roomId] = Meteor.setTimeout(function() {\n        if (Gamedata.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Vote\" },\n          });\n        }\n        playTimerStatus = \"Play complete\"\n      }, (roundtime * 1000) + (numberOfLetters * 1000) + 5000);\n      Meteor.setTimeout(function() {\n        Games.update({room_id: roomId}, {\n          $set: { playStartAnswering: true,\n                  timerSeconds: roundtime }\n        })\n        timer(roundtime, roomId, \"playtimerstate\");\n      }, (numberOfLetters * 1000) + 2000)\n\n\n      Meteor.setTimeout(function() {\n        Meteor.call('games.letterFlipFlagOff', roomId);\n      }, 2000)\n    }\n  },\n\n  'games.vote'(roomId) {\n    // Games.update({room_id: roomId}, {\n    //   $set: { playStartAnswering: false }\n    // })\n    if (!voteTimer[roomId]) { // one timer only\n      voteTimer[roomId] = Meteor.setTimeout(function() {\n        if (Gamedata.find({room_id: roomId}).fetch().length === 0) {\n          Meteor.call('games.reset', roomId );\n        } else {\n          Rooms.update({room_id: roomId}, {\n            $set: { subround: \"Results\" },\n          });\n        }\n        delete voteTimer[roomId];\n      }, 4000); //35000\n    }\n  },\n\n  'games.results'(roomId) {\n    if (!resultsTimer[roomId]) { // one timer only\n      var currentRound = Rooms.findOne({room_id: roomId}).round;\n      if (currentRound === roundsToPlay) {\n        resultsTimer[roomId] = Meteor.setTimeout(function() {\n          if (Gamedata.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n            delete resultsTimer[roomId];\n            Meteor.call('games.reset', roomId );\n          } else {\n            Rooms.update({room_id: roomId}, {\n              $set: { subround: \"Final results\" },\n            });\n          }\n          delete resultsTimer[roomId];\n        }, 22000);\n      } else {\n        resultsTimer[roomId] = Meteor.setTimeout(function() {\n          if (Gamedata.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n            delete resultsTimer[roomId];\n            Meteor.call('games.reset', roomId );\n          } else {\n            Rooms.update({room_id: roomId}, {\n              $set: { round: currentRound + 1,\n                      subround: \"Get ready\" },\n            });\n          }\n          delete resultsTimer[roomId]\n        }, 3000); //22000\n      }\n    }\n  },\n\n  'games.finalresults'(roomId) {\n    if (!finalTimer[roomId]) { // one timer only\n      finalTimer[roomId] = Meteor.setTimeout(function() {\n        if (Gamedata.find({room_id: roomId}).fetch().length < 2) { // end game after results if not enough players\n          delete finalTimer[roomId];\n          Meteor.call('games.reset', roomId );\n        } else { // set up for new game\n          Games.remove({ room_id: roomId });\n          Meteor.call('games.init', roomId );\n        }\n        delete finalTimer[roomId];\n      }, 25000);\n    }\n    readyTimer = {}\n    playTimer = {}\n    playStartTimer = {}\n    voteTimer = {}\n    resultsTimer = {}\n  },\n\n  'games.reset'(roomId) {\n    Games.remove({ room_id: roomId });\n    Gamedata.remove({ room_id: roomId });\n    Rooms.update({room_id: roomId}, {\n      $set: { round: 0,\n              subround: \"Waiting for players\" },\n    });\n    readyTimer = {}\n    playTimer = {}\n    playStartTimer = {}\n    voteTimer = {}\n    resultsTimer = {}\n  },\n\n  'games.letterFlipFlagOff'(roomId) {\n    Games.update({room_id: roomId}, {\n      $set: { turnLetters: false }\n    })\n  }\n\n})\n\nfunction timer(seconds, roomId, statetoactivate) {\n\n  Meteor.setTimeout(function() {\n    var countdownStartTime = new Date();\n    if (statetoactivate === \"playtimerstate\") {\n      Games.update({room_id: roomId}, {\n        $set: { playStartTime:countdownStartTime,\n                showAnswerForm: true }\n      })\n    } else {\n      Games.update({room_id: roomId}, {\n        $set: { voteStartTime:countdownStartTime }\n      })\n    }\n    var count = seconds;\n    var counter = Meteor.setInterval(tock, 1000);\n\n    function tock() {\n      count=count-1;\n      if (count < 0) {\n         Meteor.clearInterval(counter);\n         Games.update({room_id: roomId}, {\n            $set: { showAnswerForm: false }\n          })\n         return;\n      }\n      Games.update({room_id: roomId}, {\n        $set: { timerSeconds: count }\n      })\n    }\n  }, 2000);\n}\n\n    // Games.find({ room_id: roomId }).remove({});\n"]},"hash":"3e4d78b3e6fcbde5283da575926d9da6dcc1c18c"}
